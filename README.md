# Customer API Provider

To run the application, we use these commands:

```bash
# build with Maven and run
mvn clean package && \
  java -Dspring.profiles.active=dev -jar target/customer-api-provider-0.0.1-SNAPSHOT.jar
# directly run with Maven
mvn spring-boot:run -Dspring.profiles.active=dev
# or simply run the main method
```

Open http://localhost:8080 in your browser.

## Liquibase

We can use Liquibase to migrate our database.

> [!CAUTION]
> This competes with Hibernate's `ddl-auto` setting, so we should decide, whether we want to migrate the database schema
> - during application startup (Pod Deployment)
>   - with Hibernate (local dev)
>   - with Liquibase (dev stage, maybe prod stage)
> - otherwise (manually, or as part of a DevOps pipeline)

With Liquibase, we could write Changelogs manually, or generate them from an existing db schema. For example, when running the application in `dev` profile, the database is generated by Hibernate. We could then export the schema into changelogs via

```bash
  mvn liquibase:generateChangeLog \
    -Dliquibase.driver=org.h2.Driver \
    -Dliquibase.url=jdbc:h2:./.local-db/customers \
    -Dliquibase.username=sa \
    -Dliquibase.password= \
    -Dliquibase.outputChangeLogFile=target/liquibase/outputChangeLog.h2.sql
```

> [!CAUTION]
> We need to stop the application before, because
> H2 in file mode only allows a single connection.

> [!NOTE]
> We can find details in the [Liquibase Maven Plugin Documentation](https://docs.liquibase.com/tools-integrations/maven/home.html).

Then, we could copy the changes to the [changelog directory](src/main/resources/db/changelog) and run the application with the `liquibase` profile. This will use Liquibase to migrate the local database.
